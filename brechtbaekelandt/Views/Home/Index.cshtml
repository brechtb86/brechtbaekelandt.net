@using System.Globalization
@using brechtbaekelandt.Extensions
@using Microsoft.ApplicationInsights.AspNetCore.Extensions
@using Microsoft.AspNetCore.Html
@using Microsoft.AspNetCore.Http.Extensions
@using Newtonsoft.Json
@using Newtonsoft.Json.Serialization

@model brechtbaekelandt.ViewModels.HomeViewModel

@{
    this.ViewData["Title"] = "home";
    this.ViewData["ActivePage"] = "home";
}

@{
    var today = DateTime.Today;
    var bday = DateTime.Parse("07/02/1986", CultureInfo.InvariantCulture);

    var age = today.Year - bday.Year;

    if (today < bday.AddYears(age))
    {
        age--;
    }

    var yearsActive = today.Year - 2009;
}

<!-- Links for searchbots (because links generated by knockout don't work for indexing) -->
<div class="hidden">
    @foreach (var url in this.Model.AllPostsUrls)
    {
        <a href="@url">@url</a>
    }
</div>

<div class="loader" data-bind="visible: false">
    <i class="fas fa-spinner fa-pulse fa-2x fa-fw"></i>
    <p>loading, this won't take long...</p>
</div>

<div style="display: none;" data-bind="visible: true">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-8">
            <h2 class="title">brecht's blog</h2>
            <small>a blog about development, electronics and other stuff.</small>
            <hr />
            <form class="row">
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <div class="input-group">
                            <select class="form-control" data-bind="options: categories, optionsText: 'name', optionsValue: 'id', value: categoryIdFilter, optionsCaption: '--category--', valueUpdate: 'change, keyup'"></select>
                            <span class="input-group-addon"><i class="fas fa-filter"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" placeholder="type to start searching" class="form-control" data-bind="textInput: searchTermsFilterString, enterKey: function() { getPosts(); }, isTyping: isSearching, timeOut: 200" />
                            <span class="input-group-addon">
                                <i class="fas fa-search"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </form>
            <div class="tags-filter">
                <!-- ko if : tagsFilter().length > 0 -->
                <label>tags:</label>
                <!-- ko foreach: tagsFilter -->
                <a href="#" class="label label-default" data-bind="click: function() { $root.tagsFilter.pop($data); }"><span data-bind="text: $data"></span> <i class="fas fa-times"></i></a>
                <!-- /ko -->
                <!-- /ko -->
            </div>
            <!-- ko ifnot: isLoading -->
            <!-- ko if: posts().length === 0 -->
            <div class="text-center">no posts found...</div>
            <!-- /ko -->
            <!-- ko foreach: posts -->
            <a data-bind="attr: { href: '#post' + ($index() + 1)}"></a>
            <div data-bind="template: { name: 'postPreviewTemplate', data: { post: $data, viewModel: $root }, afterRender: function() { $root.initFancyBox(); $root.initAddThis(); } }"></div>
            <!-- /ko -->
            <!-- /ko -->
            <!-- ko if: isLoading -->
            <div data-bind="template: { name: 'loaderTemplate' }"></div>
            <!-- /ko -->
            <!-- ko ifnot: isLastPage -->
            <div data-bind="template: { name: 'loaderTemplate' }"></div>
            <!-- /ko -->
        </div>
        <div class="hidden-xs hidden-sm hidden-md col-lg-3 col-lg-offset-1">
            @*<button type="button" class="btn btn-lg btn-default btn-subscribe stretch-horizontal" data-bind="click: function() { showSubscribe(true); }"><span class="far fa-paper-plane"></span> subscribe</button>*@
            <hr />
            <div class="full-width text-center">
                <img src="~/images/me.png" class="img-responsive img-thumbnail" />
            </div>
            <hr />
            <div id="social">
                <ul>
                    <li>
                        <a href="mailto:&#098;&#114;&#101;&#099;&#104;&#116;&#046;&#098;&#097;&#101;&#107;&#101;&#108;&#097;&#110;&#100;&#116;&#064;&#111;&#117;&#116;&#108;&#111;&#111;&#107;&#046;&#099;&#111;&#109;">
                            <img src="~/images/social-email.png" />
                        </a>
                    </li>
                    <li>
                        <a href="https://facebook.com/brecht.baekelandt" target="_blank">
                            <img src="~/images/social-facebook.png" />
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/BaekelandtB" target="_blank">
                            <img src="~/images/social-twitter.png" />
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/brechtbaekelandt/" target="_blank">
                            <img src="~/images/social-linkedin.png" />
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/brechtb86" target="_blank">
                            <img src="~/images/social-github.png" />
                        </a>
                    </li>
                </ul>
            </div>
            <hr />
            <p>
                Hi there! I am Brecht. I am a .Net developer living in Brussels, Belgium. I am also a metal lover, code addict and Microsoft enthousiast.
                I absolutely love programming and I am very lucky to get to do what I love for a living.
            </p>
            <p>
                I was born @(age) years ago and have been active as a developer for @(yearsActive) years now. I've studied electronics and wrote my thesis about home automation.
            </p>
            <p>
                When I'm not working I enjoy hiking, a good movie and good music, keeping busy with an electronics project, or even experimenting with mobile app development.
            </p>
            <p>
                With this blog I want to share my knowledge, my tips and my thoughts about programming, electronics, and other stuff I'm interested in.
            </p>
            <hr />
            <!-- ko if : tags().length > 0 -->
            <label>tags:</label>
            <!-- ko foreach: tags -->
            <a href="#" class="label label-default" data-bind="text: $data,  css: { active: $root.tagsFilter.indexOf($data) > -1 }, click: function() { $root.tagsFilter.indexOf($data) === -1 ? $root.tagsFilter.push($data) : null; }"></a>
            <!-- /ko -->
            <hr />
            <!-- /ko -->
        </div>
    </div>
    <div class="modal fade" tabindex="-1" role="dialog" data-bind="modal: showSubscribe">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title text-center">subscribe to this blog</h3>
                </div>
                <div class="modal-body text-center">
                    <h4>select the categories you want to subscribe to</h4>
                    <!-- ko if: atLeastOneCategoryMessage -->
                    <div class="alert alert-warning alert-dismissable">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <span data-bind="text: atLeastOneCategoryMessage"></span>
                    </div>
                    <!-- /ko -->
                    <form>
                        <div class="text-left">
                            <fieldset class="well well-sm row categories" data-bind="disable: hasSubscribed">
                                <!-- ko foreach: categories -->
                                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-4">
                                    <div class="col-xs-6">
                                        <label data-bind="text: $data.name() + ':'"></label>
                                    </div>
                                    <div class="col-xs-6">
                                        <label class="switch">
                                            <input type="checkbox" data-bind="checkedValue: $data, checked: $parentContext.$data.subscriber.categories">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <!-- /ko -->
                            </fieldset>
                        </div>
                        <label>enter your email address</label>
                        <div class="text-left">
                            <div class="form-group" data-bind="validationElement: subscriber.emailAddress">
                                <div class="input-group" data-bind="css: { 'has-success': subscriber.emailAddress.isValid }">
                                    <span class="input-group-addon">
                                        <i class="fas fa-at"></i>
                                    </span>
                                    <input type="email" class="form-control" placeholder="your email address" data-bind="textInput: subscriber.emailAddress, disable: hasSubscribed" />
                                    <span class="input-group-btn">
                                        <button class="btn btn-primary" type="button" data-bind="click: function(){ $root.subscribe(subscriber) }, css: { 'btn-success':  subscriber.emailAddress.isValid }, enable: subscriber.emailAddress.isValid() && !hasSubscribed()"><i class="far fa-paper-plane"></i></button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p class="line-on-sides"><span>or</span></p>
                        <label>copy the RSS link</label>
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fas fa-rss-square"></i>
                            </span>
                            <input type="text" class="form-control" data-bind="value: rssLink" readonly="readonly" onclick="this.focus();this.select();" />
                            <span class="input-group-btn">
                                <button class="btn btn-primary" type="button" data-bind="click: function(){ copyRssLink($data) }, enable: subscriber.categories().length > 0"><i class="far fa-copy"></i></button>
                            </span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section styles{

    <link href="~/lib/fancybox/dist/jquery.fancybox.css" rel="stylesheet" />

    <environment include="Development">
        <link href="~/css/controls/post-preview.css" rel="stylesheet" asp-append-version="true" />

        <link href="~/css/home.css" rel="stylesheet" asp-append-version="true" />
    </environment>
}

@section scripts{
    <script src="~/lib/fancybox/dist/jquery.fancybox.js"></script>

    <environment include="Development">
        <script src="~/js/knockout/knockout.key-binding-handlers.js"></script>
        <script src="~/js/knockout/knockout.modal-bindings.js"></script>
        <script src="~/js/knockout/knockout.highlight-bindings.js"></script>

        <script src="~/js/extensions/string-extensions.js"></script>

        <script src="~/js/view-models/home.js" asp-append-version="true"></script>
    </environment>

    <script type="text/javascript">
        $(function () {
            @{
                var jsonSerializerSettings = new JsonSerializerSettings { ContractResolver = new CamelCasePropertyNamesContractResolver() };

                var serverViewmodel = new HtmlString(JsonConvert.SerializeObject(this.Model, Formatting.None, jsonSerializerSettings)).ToEscapedJSHtmlString();

            }

            brechtbaekelandt.home.init(@serverViewmodel);
        });
    </script>
}

@{
    var keywords = (string[])this.ViewData["Keywords"];
}

@section seo {
    <meta name="robots" content="index,follow" />

    <script type="application/ld+json">
        {
        "@@context": "http://schema.org",
        "@@type": "Person",
        "name": "Brecht Baekelandt",
        "url": "@this.Model.BaseUrl",
        "sameAs": [
        "https://facebook.com/brecht.baekelandt",
        "https://twitter.com/BaekelandtB",
        "https://www.linkedin.com/in/brechtbaekelandt/",
        "https://github.com/brechtb86"
        ]
        }
    </script>

    <meta name="description" content="Personal blog of Brecht Baekelandt, .Net developer, metal lover, code addict and Microsoft enthousiast." />
    <meta name="keywords" content="@string.Join(" , ", keywords)" />

    @{
        var homeIndex = this.Context.Request.GetUri().GetLeftPart(UriPartial.Path).ToLower().IndexOf("/home");

        if (homeIndex > -1)
        {
            <link rel="canonical" href="@this.Context.Request.GetUri().GetLeftPart(UriPartial.Path).ToLower().Remove(homeIndex).TrimEnd('/')" />
        }
        else
        {
            <link rel="canonical" href="@this.Context.Request.GetUri().GetLeftPart(UriPartial.Path).ToLower().TrimEnd('/')" />
        }
    }
}

@section social{
    <!-- Open Graph data -->
    <meta property="og:site_name" content="@(this.Model.BaseUrl)" />
    <meta property="og:title" content="Personal blog of Brecht Baekelandt, .Net developer, metal lover, code addict and Microsoft enthousiast." />
    <meta property="og:image" itemprop="image" content="@($"{this.Model.BaseUrl}/images/me-social.png")" />
    <meta name="medium" content="image">
    <meta property="og:type" content="website" />
    <meta property="og:description" content="This blog talks about development, electronics and other stuff that I like." />
    <meta property="og:url" content="@(this.Model.BaseUrl)" />
    <meta property="fb:app_id" content="495540337506240">

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Personal blog of Brecht Baekelandt, .Net developer, metal lover, code addict and Microsoft enthousiast.">
    <meta itemprop="description" content="This blog talks about development, electronics and other stuff that I like.">
    <meta itemprop="image" content="@($"{this.Model.BaseUrl}/images/me-social.png")">

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="brechtbaekelandt">
    <meta name="twitter:creator" content="Brecht Baekelandt">
    <meta name="twitter:title" content="Personal blog of Brecht Baekelandt, .Net developer, metal lover, code addict and Microsoft enthousiast.">
    <meta name="twitter:description" content="This blog talks about development, electronics and other stuff that I like.">
    <meta name="twitter:image:src" content="@($"{this.Model.BaseUrl}/images/me-social.png")">
}
